<?php

namespace App\Http\Controllers;

use App\Models\TreinoExercicio;
use App\Models\Exercicio;
use App\Models\Treino;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule;

class TreinoExercicioController extends Controller
{

    public function index()
    {
        return View('treinoexercicio.index')->with('treinoExercicio',TreinoExercicio::all())->with('exercicio',Exercicio::all())->with('treino',Treino::all());
    }

    public function create(Request $request)
    {
        return View('treinoexercicio.create')->with('exercicio',Exercicio::all())->with('treino',$request->treino_id);
    }

    public function store(Request $request)
    {
        $uniqueRule = Rule::unique('treino_exercicio')->where(
            function ($query) use ($request){
                return $query->where('exercicio_id',$request['exercicio_id']??'')
                ->where('nm_dia_semana_treino_exercicios',$request['dia']??'')
                ->where('dieta_id',$request['dieta_id']??'');
            });

        $validacao = $request->validate([
            'dia' => 'required|alpha_dash|string|max:20',
            'exercicio_id' => ['required','exists:exercicios,id',$uniqueRule],
            'treino_id' => 'required|exists:treinos,id'
        ]);

        TreinoExercicio::create([
            'nm_dia_semana_treino_exercicios' => $validacao['dia'],
            'exercicio_id' => $validacao['exercicio_id'],
            'treino_id' => $validacao['treino_id']
        ]);

        return View('treinoexercicio.index')->with('treinoExercicio',TreinoExercicio::all())->with('exercicio',Exercicio::all())->with('dieta',Dieta::all());
    }

    public function show(TreinoExercicio $treinoExercicio)
    {
        return View('treinoexercicio.show')->with('treinoExercicio',$treinoExercicio);
    }

    public function edit(TreinoExercicio $treinoExercicio)
    {
        return View('treinoexercicio.edit')->with('treinoExercicio',$treinoExercicio)->with('exercicio',Exercicio::all())->with('treino',Treino::all());
    }

    public function update(Request $request, TreinoExercicio $treinoExercicio)
    {
        $treinoExercicio->update($request->all());
        return View('treinoexercicio.index')->with('treinoExercicio',TreinoExercicio::all())->with('exercicio',Exercicio::all())->with('treino',Treino::all());
    }

    public function destroy(TreinoExercicio $treinoExercicio)
    {
        $treinoExercicio->delete();
        return View('treinoexercicio.index')->with('treinoExercicio',TreinoExercicio::all())->with('exercicio',Exercicio::all())->with('treino',Treino::all());
    }
}
